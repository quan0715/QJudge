name: Backend Tests

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'backend/**'
      - '.github/workflows/backend-tests.yml'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'backend/**'
      - '.github/workflows/backend-tests.yml'

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build and Run Tests using Docker Compose
      run: |
        # 使用我們定義好的測試環境配置
        docker-compose -f docker-compose.test.yml build
        
        # 執行測試
        # --abort-on-container-exit: 當測試容器結束時停止所有容器
        # --exit-code-from backend_test: 使用測試容器的退出碼作為整個命令的退出碼
        docker-compose -f docker-compose.test.yml up --abort-on-container-exit --exit-code-from backend_test
