# 翻譯機器人 Agent (i18n)

## 概述

本 Agent 負責維護專案的多語言翻譯一致性，以**正體中文（zh-TW）**為主要語言來源，同步更新其他語言版本。

## 支援語言

| 語言代碼 | 語言名稱 | 優先級 |
|---------|---------|--------|
| zh-TW | 正體中文 | **主要來源** |
| en | English | 同步目標 |
| ja | 日本語 | 同步目標 |
| ko | 한국어 | 同步目標 |

---

## 任務一：翻譯 JSON 檔案同步

### 目標

檢查正體中文翻譯 JSON 檔案與前一版本的差異，並同步更新到其他語言。

### 相關檔案位置

```
frontend/src/locales/
├── zh-TW/
│   ├── common.json      # 通用翻譯
│   ├── auth.json        # 認證相關
│   ├── problems.json    # 題目相關
│   ├── contests.json    # 競賽相關
│   ├── submissions.json # 提交相關
│   └── ...
├── en/
├── ja/
└── ko/
```

### 執行步驟

1. **差異檢測**
   - 使用 `git diff` 比較 `zh-TW/*.json` 與前一版本
   - 識別新增、修改、刪除的 key

2. **變更分類**
   - `ADDED`: 新增的翻譯 key
   - `MODIFIED`: 已修改的翻譯值
   - `DELETED`: 已刪除的翻譯 key

3. **同步策略**

   | 變更類型 | 處理方式 |
   |---------|---------|
   | ADDED | 將新 key 加入其他語言，值暫時使用 `[TODO: 翻譯]` + 原文 |
   | MODIFIED | 標記其他語言對應 key 需要更新，加入 `[OUTDATED]` 前綴 |
   | DELETED | 從所有語言檔案中移除對應 key |

4. **輸出報告**

   ```markdown
   ## 翻譯同步報告
   
   ### 變更摘要
   - 新增: X 個 key
   - 修改: X 個 key
   - 刪除: X 個 key
   
   ### 待翻譯項目
   | Key | zh-TW 原文 | 需更新語言 |
   |-----|-----------|-----------|
   | ... | ...       | en, ja, ko |
   ```

### 驗證規則

- [ ] 所有語言的 JSON 檔案 key 數量一致
- [ ] 無遺失的翻譯 key
- [ ] JSON 格式正確（無語法錯誤）
- [ ] 無重複的 key

---

## 任務二：文檔同步更新

### 目標

檢查文檔與前一版本的差異，以正體中文為主更新其他語言版本。

### 相關檔案位置

```
frontend/public/docs/
├── zh-TW/           # 主要來源
│   ├── overview.md
│   ├── quick-start.md
│   ├── e2e-testing.md
│   └── ...
├── en/              # 同步目標
├── ja/              # 同步目標
└── ko/              # 同步目標
```

### 執行步驟

1. **差異檢測**
   - 比較 `docs/zh-TW/*.md` 與前一版本
   - 識別有實質內容變更的檔案（忽略格式微調）

2. **變更分析**
   - 結構性變更：標題、章節增減
   - 內容變更：段落文字修改
   - 程式碼變更：程式碼區塊更新
   - 連結變更：內外部連結更新

3. **同步策略**

   | 變更類型 | 處理方式 |
   |---------|---------|
   | 結構性變更 | 完整同步章節結構，保留翻譯內容 |
   | 內容變更 | 標記需重新翻譯的段落 |
   | 程式碼變更 | 直接同步（程式碼通常不需翻譯） |
   | 連結變更 | 直接同步 |

4. **輸出報告**

   ```markdown
   ## 文檔同步報告
   
   ### 變更檔案
   | 檔案 | 變更類型 | 影響語言 |
   |-----|---------|---------|
   | e2e-testing.md | 內容更新 | en, ja, ko |
   ```

### 驗證規則

- [ ] 所有語言版本的檔案結構一致
- [ ] 程式碼區塊內容完全相同
- [ ] 連結有效性
- [ ] Markdown 格式正確

---

## 任務三：硬編碼檢測與 Common 整合

### 目標

1. 檢測前端頁面中的硬編碼文字
2. 將硬編碼加入翻譯 JSON 檔案
3. 分析現有 JSON 檔案，識別應整合到 `common.json` 的項目

### 檢測範圍

```
frontend/src/
├── components/      # React 元件
├── pages/           # 頁面元件
├── features/        # 功能模組
└── layouts/         # 版面配置
```

### Part A: 硬編碼檢測

**掃描規則**

- 搜尋 JSX/TSX 中的中文字串
- 搜尋 `""` 或 `''` 包裹的顯示文字
- 排除：變數名稱、程式邏輯字串、console.log、註解、CSS class、測試檔案

**檢測模式**

```tsx
// ❌ 硬編碼
<Button>提交</Button>
<p>請輸入密碼</p>
placeholder="搜尋..."

// ✅ 正確使用 i18n
<Button>{t('common.submit')}</Button>
<p>{t('auth.enterPassword')}</p>
placeholder={t('common.search')}
```

**輸出報告**

```markdown
## 硬編碼檢測報告

### 發現項目
| 檔案 | 行號 | 硬編碼內容 | 建議 Key |
|-----|-----|-----------|---------|
| LoginPage.tsx | 45 | "登入" | auth.login |
| Header.tsx | 23 | "首頁" | common.home |
```

### Part B: Common 整合分析

**識別規則 - 應加入 `common.json` 的項目**

| 類型 | 範例 | 說明 |
|-----|-----|-----|
| 通用動作 | 提交、取消、確認、刪除、編輯 | 多處使用的動作按鈕 |
| 通用狀態 | 載入中、成功、失敗、錯誤 | 狀態提示文字 |
| 通用標籤 | 標題、描述、名稱、日期 | 表單/列表常用標籤 |
| 導航項目 | 首頁、設定、個人資料 | 全站導航 |
| 時間相關 | 今天、昨天、分鐘前 | 時間顯示 |

**分析邏輯**

- IF key 在 >= 2 個不同檔案中使用
- AND key 不屬於特定功能領域
- THEN 建議移至 `common.json`

**輸出報告**

```markdown
## Common 整合建議報告

### 建議整合項目
| 目前位置 | Key | 使用次數 | 建議動作 |
|---------|-----|---------|---------|
| auth.json | submit | 5 | 移至 common.json |

### 重複 Key 警告
| Key | 出現位置 | 建議 |
|-----|---------|-----|
| cancel | auth.json, problems.json | 合併至 common.json |
```

### 驗證規則

- [ ] 無遺漏的硬編碼文字
- [ ] 新增的 key 命名符合慣例
- [ ] `common.json` 無功能專屬翻譯
- [ ] 各功能 JSON 無重複的通用翻譯

---

## 命名慣例

### JSON Key 命名規則

格式：`<namespace>.<category>.<item>`

| 層級 | 說明 | 範例 |
|-----|-----|-----|
| namespace | 功能模組 | `auth`, `problems`, `common` |
| category | 功能分類 | `form`, `button`, `message`, `label` |
| item | 具體項目 | `submit`, `cancel`, `success` |

### 範例結構

```json
{
  "auth": {
    "form": {
      "email": "電子郵件",
      "password": "密碼"
    },
    "button": {
      "login": "登入",
      "register": "註冊"
    },
    "message": {
      "loginSuccess": "登入成功",
      "loginFailed": "登入失敗"
    }
  }
}
```

---

## 執行頻率

| 任務 | 觸發條件 | 頻率 |
|-----|---------|-----|
| JSON 同步 | `zh-TW/*.json` 變更 | 每次 PR |
| 文檔同步 | `docs/zh-TW/*.md` 變更 | 每次 PR |
| 硬編碼檢測 | `src/**/*.tsx` 變更 | 每週 / 手動 |
| Common 整合 | 新增翻譯 key 時 | 每月 / 手動 |

---

## 輸出格式

Agent 執行完成後應產出：

1. **同步報告** (`translation-sync-report.md`)
2. **待辦清單** (`translation-todo.md`)
3. **自動修復的 PR**（如適用）

---

## 錯誤處理

| 錯誤類型 | 處理方式 |
|---------|---------|
| JSON 語法錯誤 | 停止執行，報告錯誤位置 |
| 翻譯 key 衝突 | 標記衝突，人工介入 |
| 檔案編碼問題 | 強制 UTF-8，報告警告 |
| Git 操作失敗 | 重試 3 次，失敗後報告 |

