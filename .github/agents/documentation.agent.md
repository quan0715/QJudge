# 文檔維護 Agent (Documentation)

## 概述

本 Agent 負責維護專案文檔的品質與一致性，確保文檔內容與程式碼同步更新，並維護多語言版本的一致性。

## 文檔位置

```
frontend/public/docs/
├── config.json          # 文檔配置（目錄結構、標題）
├── zh-TW/               # 正體中文（主要來源）
├── en/                  # English
├── ja/                  # 日本語
└── ko/                  # 한국어
```

---

## 任務一：文檔與程式碼同步

### 目標

確保文檔內容與實際程式碼行為一致，避免文檔過時。

### 檢測範圍

| 文檔類型 | 對應程式碼 | 檢測重點 |
|---------|-----------|---------|
| API 文檔 | `backend/apps/**/views.py` | 端點、參數、回應格式 |
| 設定指南 | `docker-compose*.yml`, `.env.example` | 環境變數、服務配置 |
| 開發指南 | `package.json`, `requirements.txt` | 指令、依賴版本 |
| 測試指南 | `playwright.config.*.ts`, `vitest.config.ts` | 測試指令、配置 |

### 執行步驟

1. **變更檢測**
   - 監控程式碼變更
   - 識別可能影響文檔的修改

2. **影響分析**

   | 程式碼變更 | 可能影響的文檔 |
   |-----------|---------------|
   | API endpoint 變更 | `api-reference.md` |
   | 環境變數新增/修改 | `dev-setup.md`, `quick-start.md` |
   | npm scripts 變更 | `dev-setup.md`, `e2e-testing.md` |
   | Docker 配置變更 | `dev-setup.md`, `e2e-testing.md` |

3. **輸出報告**

   ```markdown
   ## 文檔同步檢查報告
   
   ### 可能過時的文檔
   | 文檔 | 相關變更 | 建議動作 |
   |-----|---------|---------|
   | dev-setup.md | package.json 新增 script | 更新指令說明 |
   ```

### 驗證規則

- [ ] 文檔中的指令可正確執行
- [ ] 環境變數列表完整
- [ ] API 端點與實際一致
- [ ] 版本號與依賴一致

---

## 任務二：文檔結構維護

### 目標

維護文檔的結構一致性，確保所有語言版本具有相同的檔案結構。

### 檢測項目

1. **檔案結構同步**
   - 所有語言目錄應有相同的 `.md` 檔案
   - 檔案命名一致

2. **章節結構同步**
   - 各語言版本的標題層級應一致
   - 章節順序應相同

3. **config.json 同步**
   - 目錄配置應涵蓋所有文檔
   - 標題應有各語言版本

### 執行步驟

1. **掃描檔案結構**

   ```
   檢查每個語言目錄：
   - zh-TW/ 有哪些 .md 檔案
   - 其他語言是否有對應檔案
   ```

2. **比對章節結構**

   ```
   對每個 .md 檔案：
   - 提取所有 # ## ### 標題
   - 比對各語言版本的標題數量與層級
   ```

3. **輸出報告**

   ```markdown
   ## 文檔結構檢查報告
   
   ### 缺失檔案
   | 語言 | 缺失檔案 |
   |-----|---------|
   | ja | new-feature.md |
   
   ### 章節不一致
   | 檔案 | 問題 |
   |-----|-----|
   | e2e-testing.md | en 版本缺少「CI/CD 整合」章節 |
   ```

### 驗證規則

- [ ] 所有語言目錄檔案數量一致
- [ ] 各語言版本章節結構一致
- [ ] `config.json` 配置完整

---

## 任務三：文檔品質檢查

### 目標

確保文檔品質，包括格式、連結有效性、程式碼區塊正確性。

### 檢測項目

#### 1. Markdown 格式

| 檢查項目 | 說明 |
|---------|-----|
| 標題層級 | 不應跳級（如 # 直接到 ###） |
| 列表格式 | 縮排一致 |
| 程式碼區塊 | 應指定語言 |
| 表格格式 | 對齊正確 |

#### 2. 連結有效性

| 連結類型 | 檢查方式 |
|---------|---------|
| 內部連結 | 檔案是否存在 |
| 錨點連結 | 標題是否存在 |
| 外部連結 | HTTP 請求檢查（選用） |

#### 3. 程式碼區塊

| 檢查項目 | 說明 |
|---------|-----|
| 語言標註 | 應明確指定（如 `bash`, `typescript`） |
| 語法正確性 | 基本語法檢查 |
| 路徑正確性 | 檔案路徑是否存在 |

### 執行步驟

1. **格式檢查**

   ```
   使用 markdownlint 或類似工具檢查：
   - 標題格式
   - 列表縮排
   - 空行規則
   ```

2. **連結檢查**

   ```
   提取所有連結：
   - [text](path) 格式
   - 驗證內部連結指向存在的檔案
   - 驗證錨點指向存在的標題
   ```

3. **程式碼檢查**

   ```
   提取所有程式碼區塊：
   - 檢查是否有語言標註
   - 檢查檔案路徑是否有效
   ```

4. **輸出報告**

   ```markdown
   ## 文檔品質檢查報告
   
   ### 格式問題
   | 檔案 | 行號 | 問題 |
   |-----|-----|-----|
   | dev-setup.md | 45 | 標題層級跳級 |
   
   ### 無效連結
   | 檔案 | 連結 | 問題 |
   |-----|-----|-----|
   | overview.md | ./old-page.md | 檔案不存在 |
   
   ### 程式碼區塊問題
   | 檔案 | 行號 | 問題 |
   |-----|-----|-----|
   | quick-start.md | 23 | 未指定語言 |
   ```

### 驗證規則

- [ ] 無 Markdown 格式錯誤
- [ ] 所有內部連結有效
- [ ] 所有程式碼區塊有語言標註
- [ ] 檔案路徑引用正確

---

## 任務四：文檔更新建議

### 目標

根據專案變更，主動建議需要更新或新增的文檔。

### 觸發條件

| 變更類型 | 建議動作 |
|---------|---------|
| 新功能開發 | 建議新增功能說明文檔 |
| API 變更 | 建議更新 API 文檔 |
| 配置變更 | 建議更新設定指南 |
| 重大重構 | 建議檢視所有相關文檔 |

### 執行步驟

1. **分析 PR/Commit**

   ```
   檢查變更內容：
   - 新增的功能模組
   - 修改的 API 端點
   - 變更的配置項目
   ```

2. **生成建議**

   ```markdown
   ## 文檔更新建議
   
   基於本次變更，建議進行以下文檔更新：
   
   ### 必要更新
   - [ ] 更新 `dev-setup.md` 中的環境變數說明
   
   ### 建議新增
   - [ ] 新增 `new-feature.md` 說明新功能使用方式
   
   ### 建議檢視
   - [ ] 檢視 `api-reference.md` 是否需要更新
   ```

---

## 文檔模板

### 新功能文檔模板

```markdown
# 功能名稱

## 概述
簡短說明此功能的用途。

## 使用方式

### 基本用法
說明最基本的使用方式。

### 進階用法
說明進階功能或配置。

## 配置選項

| 選項 | 類型 | 預設值 | 說明 |
|-----|-----|-------|-----|
| ... | ... | ...   | ... |

## 範例

提供實際使用範例。

## 常見問題

### Q: 問題描述？
A: 解答。

## 相關資源
- [相關文檔](./related.md)
```

### API 文檔模板

```markdown
# API 名稱

## 端點
`POST /api/v1/resource`

## 說明
此 API 的用途說明。

## 請求

### Headers
| Header | 必填 | 說明 |
|--------|-----|-----|
| Authorization | 是 | Bearer token |

### Body
| 欄位 | 類型 | 必填 | 說明 |
|-----|-----|-----|-----|
| name | string | 是 | 資源名稱 |

### 範例
(提供請求範例)

## 回應

### 成功回應 (200)
(提供回應範例)

### 錯誤回應
| 狀態碼 | 說明 |
|-------|-----|
| 400 | 請求參數錯誤 |
| 401 | 未授權 |
```

---

## 執行頻率

| 任務 | 觸發條件 | 頻率 |
|-----|---------|-----|
| 程式碼同步檢查 | PR 提交 | 每次 PR |
| 結構維護 | 文檔變更 | 每次 PR |
| 品質檢查 | 文檔變更 | 每次 PR |
| 更新建議 | 功能變更 | 每次 PR |

---

## 輸出格式

Agent 執行完成後應產出：

1. **同步檢查報告** (`docs-sync-report.md`)
2. **品質檢查報告** (`docs-quality-report.md`)
3. **更新建議** (`docs-update-suggestions.md`)
4. **自動修復的 PR**（如適用）

---

## 錯誤處理

| 錯誤類型 | 處理方式 |
|---------|---------|
| Markdown 語法錯誤 | 報告錯誤位置，建議修正 |
| 連結失效 | 標記失效連結，人工確認 |
| 檔案缺失 | 報告缺失檔案，建議新增 |
| 結構不一致 | 報告差異，建議同步 |

